
# RZD_Data_Collector
Данное приложение позволяет выкачивать информацию о ценах на билеты РЖД на 45 дней.
Даты, за которые получаются данные, генерируются случайно. 
Информацию о городах России приложение получает из сообщение в телеграме (используется библиотека **Telebot**). 

Алгоритм работы программы следующий:
1. **Подготовка данных о городах России**. Если данные о городах РФ не скачаны, приложение обращается к апи телеграма, скачивает данные и загружает их локально в базу данных **sqlite**.
2. **Генерация города отправления и прибытия, времени, за которое получается информация**. На этом шагу программа может сгенерировать города отправления и прибытия из списка 1, однако удобнее использовать вариант программы, в котором города указываются вручную.
3. **Получение информации о билетах с сайта РЖД**. Приложение с помощью селениума получает данные о билетах за 20 дней.
>**Примечание** - в рандомизированном режиме города загадываются до тех пор, пока не будут найдены те, на которые в 1 день есть билеты.
4. **Обработка данных, их запись в csv**. 
5. **Построение графика отклонения цены купе от среднего значения (сделано для примера, можно было брать и места другого типа).**

Основные файлы проекта:
- **main.py** - стартовый файл проекта, где вызывается функция *generate_csv()*. Первый аргумент - использовать рандомизированный режим генерации городов отправления и прибытия или нет. Второй и третий аргумент - города прибытия и отправления (для нерандомизированного режима работы);
- **generator_csv.py** - в файле описаны функции *generate_csv()* и *plot_graph()*. Вторая рисует график отклонения цены купе от среднего значения по датам. Первая выполняет основную работу - скачивает базу данных городов (если требуется), а также закачивает информацию в csv файл (если csv файла с такими городами еще нет);
- **cities_parser.py** - файл, который отвечает за базу данных городов, в том числе за генерацию городов;
- **geo_time.py** - файл, которые получает служебную информацию о городах (например, их координаты на карте Земли), также генерирует и получает даты времени;
- **pandas_data.py** - файл отвечает за постобработку данных с помощью pandas, полученных из Selenium и загружает потом данные в csv;
- **selenium_logic.py** - файл отвечает за модули Selenium (выкачку нужной информации из браузера)

Были использованы следующие нестандартные библиотеки:
**telebot**, **sqlite3**, **geopy** (геопозиция городов), **datetime**, **dateparser**, **re**, **requests**, **pandas**, **numpy**, **matplotlib**, **os**, **random**.

В репозитории лежит уже скачанный файл **cities.db** - информация о городах, по которым рассматриваются маршруты, **Москва_Санкт-Петербург.csv** - csv файл, содержащий информацию о скачанных ценах из Москвы в Санкт-Петербург (даты с 20 июля 2023 до 8 августа 2023), а также **Москва_Санкт-Петербург.png** - график отклонения от среднего цены в купейных вагонах.

Запускается проект при помощи запуска команды *python main.py*.